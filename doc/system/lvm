##
# lvm - Logical Volume Manager
# $Header: /opt/cvsroot/doc/tech/lvm,v 1.1 2006/07/25 06:21:11 jick Exp $

= Document =
 * http://www.tldp.org/HOWTO/LVM-HOWTO/index.html
 * http://sources.redhat.com/lvm2/
 * http://sources.redhat.com/lvm/

= Two version of LVM =
 * LVM 2 - The latest and greatest version of LVM for Linux.
   LVM 2 is almost completely backward compatible with volumes created with
   LVM 1. The exception to this is snapshots (You must remove snapshot volumes
   before upgrading to LVM 2)
   LVM 2 uses the device mapper kernel driver. Device mapper support is in the
   2.6 kernel tree and there are patches available for current 2.4 kernels.
 * LVM 1 - The version that is in the 2.4 series kernel.
   LVM 1 is a mature product that has been considered stable for a couple of
   years. The kernel driver for LVM 1 is included in the 2.4 series kernels,
   but this does not mean that your 2.4.x kernel is up to date with the latest
   version of LVM.

= Anatomy of LVM =
 * This diagram gives a overview of the main elements in an LVM system:
 
	+-- Volume Group --------------------------------+
	|                                                |
	|    +----------------------------------------+	 |
	| PV | PE |  PE | PE | PE | PE | PE | PE | PE |	 |
	|    +----------------------------------------+	 |
	|      .       	  .    	     . 	      .	       	 |
	|      .          .    	     .        .	         |
	|    +----------------------------------------+	 |
	| LV | LE |  LE | LE | LE | LE | LE | LE | LE |	 |
	|    +----------------------------------------+	 |
	|            .          .        .     	   .     |
	|            . 	        .        .     	   .     |
	|    +----------------------------------------+	 |
	| PV | PE |  PE | PE | PE | PE | PE | PE | PE |	 |
	|    +----------------------------------------+	 |
	|                                                |
	+------------------------------------------------+

 * Another way to look at is this:

     hda1   hdc1      (PV:s on partitions or whole disks)                        
       \   /                                                                    
        \ /                                                                     
       diskvg        (VG)                                                       
       /  |  \                                                                  
      /   |   \                                                                 
  usrlv rootlv varlv (LV:s)
    |      |     |                                                              
 ext2  reiserfs  xfs (filesystems)    

 * volume group (VG) - The Volume Group is the highest level abstraction used
   within the LVM. It gathers together a collection of Logical Volumes and
   Physical Volumes into one administrative unit.
 * physical volume (PV) - A physical volume is typically a hard disk, though
   it may well just be a device that 'looks' like a hard disk (eg. a software
   raid device).
 * logical volume (LV) - The equivalent of a disk partition in a non-LVM
   system. The LV is visible as a standard block device; as such the LV can
   contain a file system (eg. /home).
 * physical extent (PE) - Each physical volume is divided chunks of data,
   known as physical extents, these extents have the same size as the logical
   extents for the volume group.
 * logical extent (LE) - Each logical volume is split into chunks of data,
   known as logical extents. The extent size is the same for all logical
   volumes in the volume group.

= mapping modes =
 * Linear mapping - will assign a range of PE's to an area of an LV in order
   eg., LE 1 - 99 map to PV1 and LE 100 - 347 map onto PV2.
 * Striped mapping - interleave the chunks of the logical extents across a
   number of physical volumes eg.,

		1st chunk of LE[1] -> PV1[1],
		2nd chunk of LE[1] -> PV2[1],
		3rd chunk of LE[1] -> PV3[1],
		4th chunk of LE[1] -> PV1[2],

   and so on. In certain situations this strategy can improve the performance
   of the logical volume.
 * Snapshots - A wonderful facility provided by LVM is 'snapshots'. This
   allows the administrator to create a new block device which presents an
   exact copy of a logical volume, frozen at some point in time.

= Boot time scripts =
 * LVM 1
   * startup:
     # vgscan
     # vgchange -ay
   * shutdown:
	 # vgchange -an
 * LVM 2
   * vgscan --ignorelockingfailure
   * vgchange -ay --ignorelockingfailure

= Common Tasks =
 # pvcreate /dev/hdb1
		 // Initializing disks or disk partitions
 # vgcreate my_volume_group /dev/hda1 /dev/hdb1
		 // Creating a volume group
 # vgchange -a y my_volume_group
		 // Activating a volume group
 # vgchange -a n my_volume_group
		 // Deactivate the volume group
 # vgremove my_volume_group
		 // Removing a volume group
 # vgextend my_volume_group /dev/hdc1 
		 // Adding physical volumes to a volume group
 # vgreduce my_volume_group /dev/hda1
		 // Removing physical volumes from a volume group
 # lvcreate -L1500 -ntestlv testvg 
		 // create a 1500MB linear LV named 'testlv' and its block device
		 // special '/dev/testvg/testlv'
 # lvcreate -i2 -I4 -l100 -nanothertestlv testvg
		 // create a 100 LE large logical volume with 2 stripes and stripe
		 // size 4 KB
 # lvcreate -L 1500 -ntestlv testvg /dev/sdg 
		 // want the logical volume to be allocated from a specific physical
		 // volume in the volume group
 # umount /dev/myvg/homevol
 # lvremove /dev/myvg/homevol
		 // Removing a logical volume
 # lvextend -L12G /dev/myvg/homevol
		 // extend /dev/myvg/homevol to 12 Gigabytes
 # lvextend -L+1G /dev/myvg/homevol
		 // add another gigabyte to /dev/myvg/homevol
 # umount /dev/myvg/homevol
 # resize2fs /dev/myvg/homevol
 # mount /dev/myvg/homevol /home
		 // Increase ext2/ext3 filesystem
 # resize_reiserfs -f /dev/myvg/homevol
		 // Increase Reiserfs online
 # xfs_growfs /home
		 // Increase xfs online only
 # mount -o remount,resize /home
		 // Increase jfs
 # umount /home
 # resize2fs /dev/myvg/homevol 524288
 # lvreduce -L-1G /dev/myvg/homevol
 # mount /home
		 // Reduce ext2/ext3
 # umount /home
 # resize_reiserfs -s-1G /dev/myvg/homevol
 # lvreduce -L-1G /dev/myvg/homevol
 # mount -treiserfs /dev/myvg/homevol /home
		 // Reduce Reiserfs
 # // There is no way to shrink XFS/JFS file systems.

# vim:ft=text:
