##
# qemu - open source processor emulator
# $Header: /opt/cvsroot/doc/tech/qemu,v 1.1 2006/06/30 05:32:30 jick Exp $

= Document =
 * http://www.gnome.org/~markmc/qemu-networking.html
 *

= qemu =
 -nographic
 -M ? 		: list emulated machine
 -fda file	: '/dev/fd0' for host floppy
 -hda file	: Hard disk file
 -cdrom file	: '/dev/cdrom' for host
 -boot [a|c|d]	: Boot on floppy (a), harddisk (c, default), cdrom (d).
 -kernel-kqemu: using the kernel module kqemu

= usage =
 * dd of=winxp.img seek=2000000 count=0
 * qemu-img create -f raw gentoo.img 2G
 * qemu -hda gentoo.img -cdrom gentoo.iso -boot d
 * qemu -hda gentoo.img -cdrom /dev/cdrom -boot d -m 512 -kernel-kqemu

= Accessing the network from a QEMU VM with TUN/TAP =
 * REQ:
  * bridge-utils package
  * CONFIG_TUN=[m|y]
 * make sure /dev/net/tun exists:
  * mkdir -p /dev/net; mknod /dev/net/tun c 10 200; chmod 0666 /dev/net/tun
 * setup a bridge:
  * ifconfig eth0 0.0.0.0 promisc up
  * brctl addbr br0
  * brctl addif br0 eth0
  * dhcpcd -d -t 60 br0
 * setting /etc/qemu-ifup
	<<
	#!/bin/sh

	echo "Executing /etc/qemu-ifup"
	echo "Bringing up $1 for bridged mode..."
	/sbin/ifconfig $1 0.0.0.0 promisc up
	echo "Adding $1 to br0..."
	/sbin/brctl addif br0 $1
	sleep 2
	>>
  * chmod 755 /etc/qemu-ifup
 * Running QEMU:
  * qemu -hda winxp.img -boot c -net nic,vlan=0 -net \
    tap,vlan=0,ifname=tap0,script=/etc/qemu-ifup -kernel-kqemu -m 256 \
    -localtime

= network with NAT =
 * -net user through the host IP

# vim:ft=text:
